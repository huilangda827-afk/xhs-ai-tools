# 🚀 一键启动指南（Windows 环境）

---

## ✅ 环境修复（必做，只需一次）

```bash
# 1. 进入项目目录
cd D:\multisim\MediaCrawler-main

# 2. 创建虚拟环境
uv venv

# 3. 安装所有依赖
uv pip install -r requirements.txt

# 4. 环境自检（验证）
uv run python scripts/doctor.py
```

**预期输出**：`✅ 所有检查通过！`

---

## 🎯 启动 Dashboard（已修复环境问题）

```bash
cd D:\multisim\MediaCrawler-main

uv run python -m streamlit run src/app/dashboard.py
```

**关键**：
- ✅ 使用 `uv run` 而不是直接 `streamlit`
- ✅ 使用 `python -m streamlit` 而不是 `streamlit` 命令
- ✅ 这样确保使用 `.venv` 虚拟环境，不会调用 Anaconda

**预期**：浏览器自动打开 `http://localhost:8501`

---

## 📊 功能验证

### 1. 选择数据源

左侧边栏 → 选择 **"Sample Data (演示模式)"**（最稳定）

### 2. 点击 Mine

点击 **🔍 Mine（挖掘）** 按钮

**观察**：
- ✅ 进度条：0% → 100%
- ✅ 阶段文本：步骤 1/5 → 5/5
- ✅ 详细日志：展开查看实时日志

### 3. 查看结果

**Tab 1：图谱分析**
- ✅ 交互式图谱（可拖拽、缩放）
- ✅ PageRank Top 榜单（15个核心标签）
- ✅ Rising Edges 趋势榜
  - 显示模式：Rising 或 Fallback
  - 显示 Anchor Now（基准时间）
  - 显示窗口样本数

**Tab 2：原帖样本**
- ✅ 笔记卡片（可展开查看详情）
- ✅ 分页显示

### 4. 导出提交包

左侧边栏 → 点击 **🎁 生成 Submission ZIP**

**预期**：
- ✅ 提示"正在打包..."
- ✅ 显示下载按钮
- ✅ 下载 `submission_<timestamp>.zip`

---

## ⚠️ 如果仍然失败

### 问题：doctor.py 报缺包

```bash
# 安装具体缺失的包（doctor.py 会给出命令）
uv pip install protobuf scipy networkx pyvis
```

### 问题：Dashboard 启动仍报错

```bash
# 完整重装
rmdir /s /q .venv
uv venv
uv pip install -r requirements.txt
uv run python -m streamlit run src/app/dashboard.py
```

### 问题：端口占用

```bash
# 使用其他端口
uv run python -m streamlit run src/app/dashboard.py --server.port 8502
```

---

## 🎉 成功标志

看到以下内容说明完全成功：

1. ✅ `doctor.py` 输出 "所有检查通过"
2. ✅ Dashboard 正常启动，浏览器打开页面
3. ✅ Mine 按钮能显示进度和日志
4. ✅ 图谱和榜单正常显示
5. ✅ Rising Edges 显示模式和诊断信息（即使是 Fallback）
6. ✅ 导出功能能生成并下载 ZIP

---

## 📋 完整命令序列（复制粘贴）

```bash
cd D:\multisim\MediaCrawler-main
uv venv
uv pip install -r requirements.txt
uv run python scripts/doctor.py
uv run python -m streamlit run src/app/dashboard.py
```

**5分钟内完成环境设置 + 启动！** 🚀

---

## 💡 关键改进点

### ✅ 已修复

1. **环境隔离**：强制使用 `.venv`，避免与 Anaconda 混淆
2. **依赖完整**：补齐 protobuf、scipy 等缺失依赖
3. **诊断工具**：doctor.py 一键检查并给出修复命令
4. **Rising Edges 非空保证**：
   - 基于数据 max(time) 作为 anchor_now
   - 窗口样本不足时 fallback 到全局 Top Edges
   - 显示模式标识（Rising / Fallback）
   - 显示 Anchor、窗口样本数

### 📈 效果对比

**修复前**：
- ❌ 多环境混用，依赖冲突
- ❌ Rising Edges 经常为空，无解释
- ❌ 无诊断信息

**修复后**：
- ✅ 独立虚拟环境，依赖稳定
- ✅ Rising Edges 永不为空（有 fallback）
- ✅ 完整的窗口诊断信息
- ✅ 一键自检工具

---

**准备好测试了！执行上面的完整命令序列即可！** 🎯
