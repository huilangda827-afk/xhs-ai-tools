# 🎓 最终验收指南

## ✅ 完整功能清单（Stage 1-5）

---

### 📦 Stage 1：数据爬取
- ✅ XHS 爬虫适配器
- ✅ 登录态缓存
- ✅ 20条真实数据

### 🧹 Stage 2：数据清洗
- ✅ 清洗器（标签处理、质量过滤）
- ✅ 清洗报告（100%通过率）
- ✅ 数据标准化

### 🕸️ Stage 3：图谱挖掘
- ✅ 标签共现图（117节点, 523边）
- ✅ PageRank Top 15
- ✅ Rising Edges（含 Fallback）
- ✅ Pyvis 交互式可视化

### 🖥️ Stage 4：Streamlit Dashboard
- ✅ 图谱可视化（已修复显示）
- ✅ PageRank 榜单
- ✅ Rising Edges 榜单（带诊断）
- ✅ 原帖样本展示
- ✅ Demo Mode 样例库
- ✅ 一键导出提交包

### ✨ Stage 5：文案生成（新增）
- ✅ 模板引擎（不依赖 LLM）
- ✅ 批量草稿生成
- ✅ 多账号分配
- ✅ 素材包导出（ZIP）

---

## 🧪 完整验收流程

### 步骤 1：环境检查

```bash
cd D:\multisim\MediaCrawler-main

# 运行自检
uv run python scripts/doctor.py
```

**预期**：`✅ 所有检查通过！`

---

### 步骤 2：回归测试

```bash
uv run python scripts/smoke_test.py
```

**预期**：`🎉 所有测试通过！`

---

### 步骤 3：启动 Dashboard

```bash
uv run python -m streamlit run src/app/dashboard.py
```

**或双击**：`scripts\restart_dashboard.bat`

---

### 步骤 4：功能验收

#### Tab 1：📊 图谱分析

- [ ] **图谱显示**：
  - 交互式网络图（117节点，10个社区）
  - 可拖拽、缩放
  - 节点悬停显示详情

- [ ] **PageRank Top**：
  - 15行表格
  - 第1名：AI工具（~0.0453）

- [ ] **Rising Edges**：
  - 模式标识：Fallback（黄色警告）
  - 窗口信息：Anchor, Recent, Historical
  - 10行数据（共现次数）

- [ ] **下载按钮**：
  - 📥 下载图谱 HTML
  - 本地可打开并交互

---

#### Tab 2：📝 原帖样本

- [ ] 笔记卡片列表（20条）
- [ ] 可展开查看（标题、描述、标签、链接）
- [ ] 分页功能

---

#### Tab 3：✨ 生成文案（新增）

- [ ] **参数设置**：
  - 关键词输入（默认"AI工具"）
  - 生成数量（1-20）
  - 账号模式（单账号/多账号）
  - 图片模式（No images/Source images）

- [ ] **生成按钮**：
  - 点击"🎨 生成文案包"
  - 显示进度
  - 成功提示

- [ ] **草稿预览**：
  - 显示前3条草稿
  - 可展开查看（标题、正文、标签）
  - 显示账号分配

- [ ] **导出功能**：
  - 📦 保存草稿包（到 data/packs/）
  - 📥 下载 ZIP（包含 drafts.jsonl + README.txt）

---

### 步骤 5：导出提交包

左侧边栏 → **🎁 生成 Submission ZIP**

**验证**：
- [ ] 能成功生成
- [ ] 能下载 ZIP
- [ ] 解压后包含所有数据和文档

---

## 📊 预期数据

### 文件结构

```
data/
├── raw/annotations.jsonl           (20条)
├── clean/annotations_clean.jsonl   (20条)
├── samples/annotations_sample.jsonl (20条)
├── stats/cleaning_report.json
├── output/
│   └── graph.html                  (>100KB)
└── packs/                          (新增)
    └── draft_package_<timestamp>/
        ├── drafts.jsonl
        └── README.txt
```

### 生成草稿示例

```json
{
  "title": "5个AI工具推荐 | 实测好用",
  "body": "最近在深度体验各类AI工具，发现了一些真正好用的工具...",
  "hashtags": ["AI工具", "ChatGPT", "DeepSeek", ...],
  "account": "主账号",
  "generation_method": "template",
  "timestamp": "2026-01-17T23:45:00"
}
```

---

## 🎯 演示流程（给老师展示）

### 准备（演示前）

1. 确保 `uv run python scripts/smoke_test.py` 通过
2. 预先生成一次草稿包（验证功能）
3. 准备话术

### 演示当天

**推荐流程**（5分钟）：

1. **启动** Dashboard
2. **数据源**：选择 "Sample Data (演示模式)"
3. **挖掘**：点击 Mine，展示进度和日志（30秒）
4. **图谱**：展示交互式网络图，解读社区和核心标签
5. **PageRank**：解读核心话题标签
6. **Rising Edges**：解读 Fallback 模式和窗口样本数（体现科学严谨）
7. **文案生成**：切换到 Tab 3
   - 设置参数（关键词、数量、账号模式）
   - 点击生成
   - 展示草稿预览
   - 下载素材包
8. **导出**：点击生成 Submission ZIP，展示工程规范性

---

## 💡 答辩话术要点

### 1. 完整性

> "我们实现了从**数据爬取**到**文案生成**的完整流程，每个环节都有日志和报告，确保可复现。"

### 2. 科研深度

> "使用**图结构挖掘**方法，基于 PageRank 发现核心话题，基于时间窗口对比发现趋势，体现了数据科学的研究深度。"

### 3. 工程稳定性

> "实现了 **Demo Mode** 和 **Fallback 机制**，即使窗口样本不足，系统也能给出有意义的分析结果，这是生产环境的基本要求。"

### 4. 创新点

> "不仅做了数据分析，还实现了**文案生成功能**，将分析结果转化为创作素材，形成了从情报到生产的闭环。"

---

## 🔒 回归保护

### 改动前必须运行

```bash
uv run python scripts/smoke_test.py
```

### 改动后必须验证

- [ ] smoke_test 仍然通过
- [ ] Dashboard 所有 Tab 仍可用
- [ ] Mine 功能仍正常
- [ ] 图谱仍能显示

---

## 📞 故障排查

### 问题：Tab 3 不显示

**原因**：dashboard.py 导入失败

**解决**：
```bash
uv run python -c "from src.generator.template_engine import TemplateEngine; print('OK')"
```

### 问题：生成文案失败

**原因**：PageRank 数据为空

**解决**：先运行 Mine，确保有挖掘结果

---

## 🎉 完成标志

- [x] Stage 1-4 原有功能全部正常
- [x] 图谱能正常显示（不空白）
- [x] Rising Edges 有 Fallback 机制
- [x] 新增 Tab 3：文案生成
- [x] 文案生成不依赖 LLM
- [x] 素材包能导出 ZIP
- [x] smoke_test 通过
- [x] 所有文档齐全

---

**系统已完全就绪！可以启动演示了！** 🚀🎓
